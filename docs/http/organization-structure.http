### ===========================================
### ORGANIZATION STRUCTURE MODULE - HTTP TESTS
### ===========================================
### Base URL: http://localhost:5000/organization-structure
### ===========================================


### -------------------------------------------
### DEPARTMENT ENDPOINTS (1-10)
### -------------------------------------------

### 1. POST Create Department
POST http://localhost:5000/organization-structure/departments
Content-Type: application/json

{
  "code": "DEPT-001",
  "name": "Engineering",
  "description": "Software Engineering Department"
}

### 2. GET All Departments
GET http://localhost:5000/organization-structure/departments

### 3. GET All Active Departments
GET http://localhost:5000/organization-structure/departments?isActive=true

### 4. GET Search Departments
GET http://localhost:5000/organization-structure/departments/search?query=Engineering&page=1&limit=10

### 5. GET Department Stats
GET http://localhost:5000/organization-structure/departments/stats

### 6. GET Department By ID
GET http://localhost:5000/organization-structure/departments/{{departmentId}}

### 7. GET Department Hierarchy
GET http://localhost:5000/organization-structure/departments/{{departmentId}}/hierarchy

### 8. PATCH Update Department
PATCH http://localhost:5000/organization-structure/departments/{{departmentId}}
Content-Type: application/json

{
  "name": "Engineering & Development",
  "description": "Updated description"
}

### 9. PATCH Deactivate Department
PATCH http://localhost:5000/organization-structure/departments/{{departmentId}}/deactivate

### 10. PATCH Reactivate Department
PATCH http://localhost:5000/organization-structure/departments/{{departmentId}}/reactivate


### -------------------------------------------
### POSITION ENDPOINTS (11-22)
### -------------------------------------------

### 11. POST Create Position
POST http://localhost:5000/organization-structure/positions
Content-Type: application/json

{
  "code": "POS-001",
  "title": "Senior Software Engineer",
  "description": "Senior level engineering position",
  "departmentId": "{{departmentId}}"
}

### 12. POST Create Position with Reports To
POST http://localhost:5000/organization-structure/positions
Content-Type: application/json

{
  "code": "POS-002",
  "title": "Junior Software Engineer",
  "description": "Junior level engineering position",
  "departmentId": "{{departmentId}}",
  "reportsToPositionId": "{{positionId}}"
}

### 13. GET All Positions
GET http://localhost:5000/organization-structure/positions

### 14. GET Positions by Department
GET http://localhost:5000/organization-structure/positions?departmentId={{departmentId}}

### 15. GET Active Positions
GET http://localhost:5000/organization-structure/positions?isActive=true

### 16. GET Search Positions
GET http://localhost:5000/organization-structure/positions/search?query=Engineer&page=1&limit=10

### 17. GET Position Stats
GET http://localhost:5000/organization-structure/positions/stats

### 18. GET Position By ID
GET http://localhost:5000/organization-structure/positions/{{positionId}}

### 19. GET Position Subordinates
GET http://localhost:5000/organization-structure/positions/{{positionId}}/subordinates

### 20. PATCH Update Position
PATCH http://localhost:5000/organization-structure/positions/{{positionId}}
Content-Type: application/json

{
  "title": "Lead Software Engineer",
  "description": "Lead engineering position"
}

### 21. PATCH Deactivate Position
PATCH http://localhost:5000/organization-structure/positions/{{positionId}}/deactivate
Content-Type: application/json

{
  "reason": "Position no longer needed"
}

### 22. PATCH Reactivate Position
PATCH http://localhost:5000/organization-structure/positions/{{positionId}}/reactivate


### -------------------------------------------
### ASSIGNMENT ENDPOINTS (23-29)
### -------------------------------------------

### 23. POST Assign Employee to Position
POST http://localhost:5000/organization-structure/assignments
Content-Type: application/json

{
  "employeeProfileId": "{{employeeId}}",
  "positionId": "{{positionId}}",
  "startDate": "2025-01-01",
  "reason": "New hire",
  "notes": "Initial assignment"
}

### 24. GET Search Assignments
GET http://localhost:5000/organization-structure/assignments?page=1&limit=10

### 25. GET Active Assignments
GET http://localhost:5000/organization-structure/assignments?activeOnly=true

### 26. GET Assignments by Employee
GET http://localhost:5000/organization-structure/assignments?employeeProfileId={{employeeId}}

### 27. GET Employee Assignment History
GET http://localhost:5000/organization-structure/assignments/employee/{{employeeId}}/history

### 28. GET Assignment By ID
GET http://localhost:5000/organization-structure/assignments/{{assignmentId}}

### 29. PATCH End Assignment
PATCH http://localhost:5000/organization-structure/assignments/{{assignmentId}}/end
Content-Type: application/json

{
  "endDate": "2025-12-31",
  "reason": "Position change",
  "notes": "Employee moving to different role"
}


### -------------------------------------------
### CHANGE REQUEST ENDPOINTS (30-40)
### -------------------------------------------

### 30. POST Create Change Request - New Position
POST http://localhost:5000/organization-structure/change-requests
Content-Type: application/json

{
  "requestedByEmployeeId": "{{employeeId}}",
  "requestType": "NEW_POSITION",
  "targetDepartmentId": "{{departmentId}}",
  "details": "Need a new DevOps Engineer position",
  "reason": "Team expansion"
}

### 31. POST Create Change Request - Update Position
POST http://localhost:5000/organization-structure/change-requests
Content-Type: application/json

{
  "requestedByEmployeeId": "{{employeeId}}",
  "requestType": "UPDATE_POSITION",
  "targetPositionId": "{{positionId}}",
  "details": "Update reporting line",
  "reason": "Restructuring"
}

### 32. GET Search Change Requests
GET http://localhost:5000/organization-structure/change-requests?page=1&limit=10

### 33. GET Change Requests by Status
GET http://localhost:5000/organization-structure/change-requests?status=SUBMITTED

### 34. GET Pending Requests Count
GET http://localhost:5000/organization-structure/change-requests/count/pending

### 35. GET Change Request By ID
GET http://localhost:5000/organization-structure/change-requests/{{changeRequestId}}

### 36. GET Change Request By Number
GET http://localhost:5000/organization-structure/change-requests/by-number/{{requestNumber}}

### 37. GET Approvals for Change Request
GET http://localhost:5000/organization-structure/change-requests/{{changeRequestId}}/approvals

### 38. PATCH Update Change Request
PATCH http://localhost:5000/organization-structure/change-requests/{{changeRequestId}}
Content-Type: application/json

{
  "details": "Updated details",
  "reason": "Updated reason"
}

### 39. PATCH Cancel Change Request
PATCH http://localhost:5000/organization-structure/change-requests/{{changeRequestId}}/cancel

### 40. POST Approve Change Request
POST http://localhost:5000/organization-structure/change-requests/{{changeRequestId}}/approvals
Content-Type: application/json

{
  "approverEmployeeId": "{{adminEmployeeId}}",
  "decision": "APPROVED",
  "comments": "Approved - budget available"
}

### 41. POST Reject Change Request
POST http://localhost:5000/organization-structure/change-requests/{{changeRequestId}}/approvals
Content-Type: application/json

{
  "approverEmployeeId": "{{adminEmployeeId}}",
  "decision": "REJECTED",
  "comments": "Rejected - insufficient justification"
}


### -------------------------------------------
### ORG CHART & CHANGE LOGS (42-44)
### -------------------------------------------

### 42. GET Organization Chart
GET http://localhost:5000/organization-structure/org-chart

### 43. GET Change Logs for Department
GET http://localhost:5000/organization-structure/change-logs/Department/{{departmentId}}?page=1&limit=10

### 44. GET Change Logs for Position
GET http://localhost:5000/organization-structure/change-logs/Position/{{positionId}}?page=1&limit=10


### ===========================================
### EDGE CASE TESTS (45-70)
### ===========================================

### 45. ERROR: Create Department - Duplicate Code
POST http://localhost:5000/organization-structure/departments
Content-Type: application/json

{
  "code": "DEPT-001",
  "name": "Duplicate Department"
}

### 46. ERROR: Create Department - Duplicate Name
POST http://localhost:5000/organization-structure/departments
Content-Type: application/json

{
  "code": "DEPT-999",
  "name": "Engineering"
}

### 47. ERROR: Get Department - Not Found
GET http://localhost:5000/organization-structure/departments/507f1f77bcf86cd799439011

### 48. ERROR: Get Department - Invalid ID
GET http://localhost:5000/organization-structure/departments/invalid-id

### 49. ERROR: Update Department - Duplicate Code
PATCH http://localhost:5000/organization-structure/departments/{{departmentId}}
Content-Type: application/json

{
  "code": "{{existingDepartmentCode}}"
}

### 50. ERROR: Deactivate Department - Has Active Positions
PATCH http://localhost:5000/organization-structure/departments/{{departmentWithPositions}}/deactivate

### 51. ERROR: Deactivate Department - Already Inactive
PATCH http://localhost:5000/organization-structure/departments/{{inactiveDepartmentId}}/deactivate

### 52. ERROR: Reactivate Department - Already Active
PATCH http://localhost:5000/organization-structure/departments/{{activeDepartmentId}}/reactivate

### 53. ERROR: Create Position - Duplicate Code
POST http://localhost:5000/organization-structure/positions
Content-Type: application/json

{
  "code": "POS-001",
  "title": "Duplicate Position",
  "departmentId": "{{departmentId}}"
}

### 54. ERROR: Create Position - Department Not Found
POST http://localhost:5000/organization-structure/positions
Content-Type: application/json

{
  "code": "POS-999",
  "title": "New Position",
  "departmentId": "507f1f77bcf86cd799439011"
}

### 55. ERROR: Create Position - Inactive Department
POST http://localhost:5000/organization-structure/positions
Content-Type: application/json

{
  "code": "POS-999",
  "title": "New Position",
  "departmentId": "{{inactiveDepartmentId}}"
}

### 56. ERROR: Create Position - Reports To Not Found
POST http://localhost:5000/organization-structure/positions
Content-Type: application/json

{
  "code": "POS-999",
  "title": "New Position",
  "departmentId": "{{departmentId}}",
  "reportsToPositionId": "507f1f77bcf86cd799439011"
}

### 57. ERROR: Create Position - Reports To Inactive
POST http://localhost:5000/organization-structure/positions
Content-Type: application/json

{
  "code": "POS-999",
  "title": "New Position",
  "departmentId": "{{departmentId}}",
  "reportsToPositionId": "{{inactivePositionId}}"
}

### 58. ERROR: Update Position - Reports To Self
PATCH http://localhost:5000/organization-structure/positions/{{positionId}}
Content-Type: application/json

{
  "reportsToPositionId": "{{positionId}}"
}

### 59. ERROR: Update Position - Circular Reporting
PATCH http://localhost:5000/organization-structure/positions/{{parentPositionId}}
Content-Type: application/json

{
  "reportsToPositionId": "{{childPositionId}}"
}

### 60. ERROR: Deactivate Position - Has Active Assignments
PATCH http://localhost:5000/organization-structure/positions/{{positionWithAssignments}}/deactivate

### 61. ERROR: Deactivate Position - Has Subordinates
PATCH http://localhost:5000/organization-structure/positions/{{positionWithSubordinates}}/deactivate

### 62. ERROR: Deactivate Position - Is Department Head
PATCH http://localhost:5000/organization-structure/positions/{{departmentHeadPositionId}}/deactivate

### 63. ERROR: Reactivate Position - Inactive Department
PATCH http://localhost:5000/organization-structure/positions/{{positionInInactiveDept}}/reactivate

### 64. ERROR: Assign - Position Inactive
POST http://localhost:5000/organization-structure/assignments
Content-Type: application/json

{
  "employeeProfileId": "{{employeeId}}",
  "positionId": "{{inactivePositionId}}",
  "startDate": "2025-01-01"
}

### 65. ERROR: Assign - Already Assigned to Same Position
POST http://localhost:5000/organization-structure/assignments
Content-Type: application/json

{
  "employeeProfileId": "{{assignedEmployeeId}}",
  "positionId": "{{assignedPositionId}}",
  "startDate": "2025-01-01"
}

### 66. ERROR: End Assignment - Already Ended
PATCH http://localhost:5000/organization-structure/assignments/{{endedAssignmentId}}/end
Content-Type: application/json

{
  "endDate": "2025-12-31"
}

### 67. ERROR: End Assignment - End Before Start
PATCH http://localhost:5000/organization-structure/assignments/{{assignmentId}}/end
Content-Type: application/json

{
  "endDate": "2020-01-01"
}

### 68. ERROR: Change Request - Duplicate Pending
POST http://localhost:5000/organization-structure/change-requests
Content-Type: application/json

{
  "requestedByEmployeeId": "{{employeeId}}",
  "requestType": "NEW_POSITION",
  "targetDepartmentId": "{{departmentId}}",
  "details": "Duplicate request",
  "reason": "Should fail"
}

### 69. ERROR: Update Change Request - Not Draft/Submitted
PATCH http://localhost:5000/organization-structure/change-requests/{{approvedRequestId}}
Content-Type: application/json

{
  "details": "Cannot update approved request"
}

### 70. ERROR: Reject Without Comments
POST http://localhost:5000/organization-structure/change-requests/{{changeRequestId}}/approvals
Content-Type: application/json

{
  "approverEmployeeId": "{{adminEmployeeId}}",
  "decision": "REJECTED"
}

### 71. ERROR: Create Department with Head Position
POST http://localhost:5000/organization-structure/departments
Content-Type: application/json

{
  "code": "DEPT-NEW",
  "name": "New Department",
  "headPositionId": "{{positionId}}"
}

### 72. ERROR: Set Head Position from Different Department
PATCH http://localhost:5000/organization-structure/departments/{{departmentId}}
Content-Type: application/json

{
  "headPositionId": "{{positionFromOtherDepartment}}"
}

### 73. ERROR: Assignment Department Mismatch
POST http://localhost:5000/organization-structure/assignments
Content-Type: application/json

{
  "employeeProfileId": "{{employeeId}}",
  "positionId": "{{positionId}}",
  "departmentId": "{{otherDepartmentId}}",
  "startDate": "2025-01-01"
}


### ===========================================
### END OF TESTS
### ===========================================


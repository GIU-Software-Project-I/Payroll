### =====================================================
### LEAVES MODULE - HTTP TEST FILE
### All Routes with Test Cases
### Base URL: http://localhost:5000
### =====================================================

### =====================================================
### 1. LEAVE CATEGORIES
### =====================================================

### 1.1 Create Leave Category
POST http://localhost:5000/leaves/categories
Content-Type: application/json

{
  "name": "Annual Leaves",
  "description": "Annual leave types that are deducted from balance"
}

### 1.2 Create Another Leave Category
POST http://localhost:5000/leaves/categories
Content-Type: application/json

{
  "name": "Medical",
  "description": "Medical and health-related leave types"
}

### 1.3 Get All Leave Categories
GET http://localhost:5000/leaves/categories

### 1.4 Get Leave Category by ID
GET http://localhost:5000/leaves/categories/693a800a7e07119e5fd6a9a4

### 1.5 Update Leave Category
PUT http://localhost:5000/leaves/categories/693a800a7e07119e5fd6a9a4
Content-Type: application/json

{
  "name": "Vacation",
  "description": "Vacation and personal time off - Updated"
}

### 1.6 Delete Leave Category
DELETE http://localhost:5000/leaves/categories/693a800a7e07119e5fd6a9a4

### =====================================================
### 2. LEAVE TYPES
### =====================================================

### 2.1 Create Leave Type - Annual Leave
POST http://localhost:5000/leaves/types
Content-Type: application/json

{
  "code": "ANNUAL",
  "name": "Annual Leave",
  "categoryId": "693a800a7e07119e5fd6a9a4",
  "description": "Standard annual leave",
  "paid": true,
  "deductible": true,
  "requiresAttachment": false,
  "minTenureMonths": 0,
  "maxDurationDays": 30
}

### 2.2 Create Leave Type - Sick Leave
POST http://localhost:5000/leaves/types
Content-Type: application/json

{
  "code": "SICK",
  "name": "Sick Leave",
  "categoryId": "693a800a7e07119e5fd6a9a5",
  "description": "Medical leave due to illness",
  "paid": true,
  "deductible": true,
  "requiresAttachment": true,
  "attachmentType": "medical",
  "minTenureMonths": 0,
  "maxDurationDays": 14
}

### 2.3 Create Leave Type - Unpaid Leave
POST http://localhost:5000/leaves/types
Content-Type: application/json

{
  "code": "UNPAID",
  "name": "Unpaid Leave",
  "categoryId": "693a800a7e07119e5fd6a9a7",
  "description": "Leave without pay",
  "paid": false,
  "deductible": false,
  "requiresAttachment": false
}

### 2.4 Get All Leave Types
GET http://localhost:5000/leaves/types

### 2.5 Get Leave Type by ID
GET http://localhost:5000/leaves/types/693a800a7e07119e5fd6a9aa

### 2.6 Update Leave Type
PUT http://localhost:5000/leaves/types/693a800a7e07119e5fd6a9aa
Content-Type: application/json

{
  "name": "Sick Leave - Updated",
  "maxDurationDays": 14
}

### 2.7 Set Eligibility Rules for Leave Type
PATCH http://localhost:5000/leaves/types/693a800a7e07119e5fd6a9aa/eligibility
Content-Type: application/json

{
  "minTenureDays": 90,
  "employmentTypes": ["full-time", "part-time"]
}

### 2.8 Delete Leave Type (Error - has requests)
DELETE http://localhost:5000/leaves/types/693a800a7e07119e5fd6a9aa

### =====================================================
### 3. LEAVE POLICIES
### =====================================================

### 3.1 Create Leave Policy for Annual Leave
POST http://localhost:5000/leaves/policies
Content-Type: application/json

{
  "leaveTypeId": "693a800a7e07119e5fd6a9a9",
  "accrualMethod": "monthly",
  "monthlyRate": 1.75,
  "yearlyRate": 21,
  "carryForwardAllowed": true,
  "maxCarryForward": 45,
  "expiryAfterMonths": 12,
  "roundingRule": "round",
  "minNoticeDays": 3,
  "maxConsecutiveDays": 14
}

### 3.2 Create Leave Policy for Sick Leave
POST http://localhost:5000/leaves/policies
Content-Type: application/json

{
  "leaveTypeId": "693a800a7e07119e5fd6a9aa",
  "accrualMethod": "yearly",
  "yearlyRate": 10,
  "carryForwardAllowed": false,
  "roundingRule": "round_down",
  "minNoticeDays": 0,
  "maxConsecutiveDays": 14
}

### 3.3 Get All Policies
GET http://localhost:5000/leaves/policies

### 3.4 Get Policy by ID
GET http://localhost:5000/leaves/policies/693a800a7e07119e5fd6a9b0

### 3.5 Get Policy by Leave Type ID
GET http://localhost:5000/leaves/policies/by-leave-type/693a800a7e07119e5fd6a9a9

### 3.6 Update Policy
PUT http://localhost:5000/leaves/policies/693a800a7e07119e5fd6a9b0
Content-Type: application/json

{
  "maxCarryForward": 30,
  "minNoticeDays": 5
}

### 3.7 Delete Policy
DELETE http://localhost:5000/leaves/policies/693a800a7e07119e5fd6a9b0

### =====================================================
### 4. CALENDAR / HOLIDAYS / BLOCKED PERIODS
### =====================================================

### 4.1 Add Holiday
POST http://localhost:5000/leaves/calendar/holidays
Content-Type: application/json

{
  "year": 2025,
  "date": "2025-12-25",
  "reason": "Christmas Day"
}

### 4.2 Add Another Holiday
POST http://localhost:5000/leaves/calendar/holidays
Content-Type: application/json

{
  "year": 2025,
  "date": "2025-01-01",
  "reason": "New Year's Day"
}

### 4.3 Add Blocked Period
POST http://localhost:5000/leaves/calendar/blocked-periods
Content-Type: application/json

{
  "year": 2025,
  "from": "2025-12-20",
  "to": "2025-12-31",
  "reason": "End of year closing - No leave allowed"
}

### 4.4 Get Calendar for Year
GET http://localhost:5000/leaves/calendar/2025

### 4.5 Update Calendar
PUT http://localhost:5000/leaves/calendar/2025
Content-Type: application/json

{
  "holidays": ["2025-01-01", "2025-12-25", "2025-07-04"]
}

### 4.6 Remove Holiday
DELETE http://localhost:5000/leaves/calendar/2025/holidays
Content-Type: application/json

{
  "date": "2025-07-04"
}

### 4.7 Remove Blocked Period
DELETE http://localhost:5000/leaves/calendar/2025/blocked-periods
Content-Type: application/json

{
  "from": "2025-12-20",
  "to": "2025-12-31"
}

### =====================================================
### 5. ENTITLEMENTS
### =====================================================

### 5.1 Create Entitlement
POST http://localhost:5000/leaves/entitlements
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "leaveTypeId": "693a800a7e07119e5fd6a9a9",
  "yearlyEntitlement": 21,
  "accruedActual": 0,
  "accruedRounded": 0,
  "carryForward": 5,
  "taken": 0,
  "pending": 0,
  "remaining": 26
}

### 5.2 Assign Personalized Entitlement
POST http://localhost:5000/leaves/entitlements/assign
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "leaveTypeId": "693a800a7e07119e5fd6a9aa",
  "yearlyEntitlement": 10
}

### 5.3 Get Employee Entitlements
GET http://localhost:5000/leaves/entitlements/693a80047e07119e5fd6a8d9

### 5.4 Get Employee Entitlement Summary
GET http://localhost:5000/leaves/employees/693a80047e07119e5fd6a8d9/entitlement-summary

### =====================================================
### 6. ATTACHMENTS
### =====================================================

### 6.1 Save Attachment
POST http://localhost:5000/leaves/attachments
Content-Type: application/json

{
  "originalName": "medical_certificate.pdf",
  "filePath": "/uploads/leaves/medical_certificate_12345.pdf",
  "fileType": "application/pdf",
  "size": 102400
}

### 6.2 Get Attachment
GET http://localhost:5000/leaves/attachments/693a800a7e07119e5fd6a9b9

### 6.3 Validate Medical Attachment
GET http://localhost:5000/leaves/attachments/693a800a7e07119e5fd6a9b9/validate-medical

### 6.4 Delete Attachment
DELETE http://localhost:5000/leaves/attachments/693a800a7e07119e5fd6a9b9

### =====================================================
### 7. LEAVE REQUESTS
### =====================================================

### 7.1 Create Leave Request - Annual Leave
POST http://localhost:5000/leaves/requests
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "leaveTypeId": "693a800a7e07119e5fd6a9a9",
  "from": "2026-02-01",
  "to": "2026-02-05",
  "justification": "Family vacation"
}

### 7.2 Create Leave Request - Sick Leave with Attachment
POST http://localhost:5000/leaves/requests
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8da",
  "leaveTypeId": "693a800a7e07119e5fd6a9aa",
  "from": "2025-12-20",
  "to": "2025-12-22",
  "justification": "Flu recovery",
  "attachmentId": "693a800a7e07119e5fd6a9b9"
}

### 7.3 Create Post-Leave Request (submitted after leave taken)
POST http://localhost:5000/leaves/requests
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "leaveTypeId": "693a800a7e07119e5fd6a9aa",
  "from": "2025-12-01",
  "to": "2025-12-02",
  "justification": "Emergency sick leave - submitting after leave",
  "postLeave": true
}

### 7.4 Create Leave Request - Error: Overlapping dates
POST http://localhost:5000/leaves/requests
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "leaveTypeId": "693a800a7e07119e5fd6a9a9",
  "from": "2026-01-18",
  "to": "2026-01-22",
  "justification": "Should fail - overlaps with existing request"
}

### 7.5 Create Leave Request - Error: Insufficient balance
POST http://localhost:5000/leaves/requests
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "leaveTypeId": "693a800a7e07119e5fd6a9a9",
  "from": "2026-03-01",
  "to": "2026-04-15",
  "justification": "Long vacation - should fail if balance is insufficient"
}

### 7.6 Create Leave Request - Error: Blocked period
POST http://localhost:5000/leaves/requests
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "leaveTypeId": "693a800a7e07119e5fd6a9a9",
  "from": "2025-12-25",
  "to": "2025-12-28",
  "justification": "Should fail - falls within blocked period"
}

### 7.7 Create Leave Request - Error: Sick leave > 1 day without attachment
POST http://localhost:5000/leaves/requests
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "leaveTypeId": "693a800a7e07119e5fd6a9aa",
  "from": "2026-01-10",
  "to": "2026-01-12",
  "justification": "Should fail - sick leave > 1 day requires medical certificate"
}

### 7.8 Get All Leave Requests
GET http://localhost:5000/leaves/requests?page=1&limit=20

### 7.9 Get Leave Requests with Filters
GET http://localhost:5000/leaves/requests?employeeId=693a80047e07119e5fd6a8d9&status=pending

### 7.10 Get Leave Request by ID
GET http://localhost:5000/leaves/requests/693a800a7e07119e5fd6a9bd

### 7.11 Update Leave Request (only pending)
PATCH http://localhost:5000/leaves/requests/693a800a7e07119e5fd6a9bd
Content-Type: application/json

{
  "from": "2026-01-16",
  "to": "2026-01-21",
  "justification": "Updated dates for family vacation"
}

### 7.12 Cancel Pending Leave Request
PATCH http://localhost:5000/leaves/requests/693a800a7e07119e5fd6a9bd/cancel?employeeId=693a80047e07119e5fd6a8d9

### 7.13 Cancel Approved Leave Request (restores balance)
PATCH http://localhost:5000/leaves/requests/693a800a7e07119e5fd6a9c1/cancel?employeeId=693a80047e07119e5fd6a8da

### =====================================================
### 8. APPROVAL WORKFLOW
### =====================================================

### 8.1 Manager Approve Leave Request
PATCH http://localhost:5000/leaves/requests/693a800a7e07119e5fd6a9bd/manager-approve?managerId=64f0b3c2f4a5a00099999999

### 8.2 Manager Reject Leave Request
PATCH http://localhost:5000/leaves/requests/693a800a7e07119e5fd6a9c1/manager-reject?managerId=64f0b3c2f4a5a00099999999&reason=Operational requirements

### 8.3 HR Finalize - Approve
PATCH http://localhost:5000/leaves/requests/693a800a7e07119e5fd6a9bd/hr-finalize?hrId=64f0b3c2f4a5a00088888888&decision=approve

### 8.4 HR Finalize - Reject
PATCH http://localhost:5000/leaves/requests/693a800a7e07119e5fd6a9c1/hr-finalize?hrId=64f0b3c2f4a5a00088888888&decision=reject

### 8.5 HR Finalize - Approve with Negative Balance Override
PATCH http://localhost:5000/leaves/requests/693a800a7e07119e5fd6a9bd/hr-finalize?hrId=64f0b3c2f4a5a00088888888&decision=approve&allowNegative=true

### 8.6 HR Override Manager Rejection (approve previously rejected)
PATCH http://localhost:5000/leaves/requests/693a800a7e07119e5fd6a9c1/hr-finalize?hrId=64f0b3c2f4a5a00088888888&decision=approve

### 8.7 Bulk Process Leave Requests - Approve
POST http://localhost:5000/leaves/requests/bulk-process
Content-Type: application/json

{
  "requestIds": ["693a800a7e07119e5fd6a9bd", "693a800a7e07119e5fd6a9c1"],
  "action": "approve",
  "actorId": "64f0b3c2f4a5a00099999999"
}

### 8.8 Bulk Process Leave Requests - Reject
POST http://localhost:5000/leaves/requests/bulk-process
Content-Type: application/json

{
  "requestIds": ["693a800a7e07119e5fd6a9bd"],
  "action": "reject",
  "actorId": "64f0b3c2f4a5a00099999999"
}

### =====================================================
### 9. ADJUSTMENTS
### =====================================================

### 9.1 Manual Adjustment - Add Days
POST http://localhost:5000/leaves/adjustments
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "leaveTypeId": "693a800a7e07119e5fd6a9a9",
  "adjustmentType": "add",
  "amount": 5,
  "reason": "Special grant for excellent performance",
  "hrUserId": "64f0b3c2f4a5a00088888888"
}

### 9.2 Manual Adjustment - Deduct Days
POST http://localhost:5000/leaves/adjustments
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "leaveTypeId": "693a800a7e07119e5fd6a9a9",
  "adjustmentType": "deduct",
  "amount": 2,
  "reason": "Correction for previous miscalculation",
  "hrUserId": "64f0b3c2f4a5a00088888888"
}

### 9.3 Manual Adjustment - Encashment
POST http://localhost:5000/leaves/adjustments
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "leaveTypeId": "693a800a7e07119e5fd6a9a9",
  "adjustmentType": "encashment",
  "amount": 10,
  "reason": "Year-end encashment request",
  "hrUserId": "64f0b3c2f4a5a00088888888"
}

### 9.4 Get Adjustment History
GET http://localhost:5000/leaves/employees/693a80047e07119e5fd6a8d9/adjustment-history

### 9.5 Get Adjustment History by Leave Type
GET http://localhost:5000/leaves/employees/693a80047e07119e5fd6a8d9/adjustment-history?leaveTypeId=693a800a7e07119e5fd6a9a9

### =====================================================
### 10. EMPLOYEE SELF-SERVICE
### =====================================================

### 10.1 Get Employee Balances
GET http://localhost:5000/leaves/employees/693a80047e07119e5fd6a8d9/balances

### 10.2 Get Employee Leave History
GET http://localhost:5000/leaves/employees/693a80047e07119e5fd6a8d9/history

### 10.3 Get Employee Leave History with Filters
GET http://localhost:5000/leaves/employees/693a80047e07119e5fd6a8d9/history?status=approved&from=2025-01-01&to=2025-12-31

### 10.4 Get Leave Usage Last Years (for sick leave tracking)
GET http://localhost:5000/leaves/employees/693a80047e07119e5fd6a8d9/leave-usage?leaveTypeId=693a800a7e07119e5fd6a9aa&years=3

### 10.5 Get Leave Count for Type (e.g., maternity count)
GET http://localhost:5000/leaves/employees/693a80047e07119e5fd6a8d9/leave-count?leaveTypeId=693a800a7e07119e5fd6a9ab

### =====================================================
### 11. MANAGER VIEWS
### =====================================================

### 11.1 Get Team Balances
GET http://localhost:5000/leaves/manager/64f0b3c2f4a5a00099999999/team-balances

### 11.2 Get Team Requests
GET http://localhost:5000/leaves/manager/64f0b3c2f4a5a00099999999/team-requests

### 11.3 Get Team Requests with Filters
GET http://localhost:5000/leaves/manager/64f0b3c2f4a5a00099999999/team-requests?status=pending&from=2025-01-01

### 11.4 Get Irregular Patterns
GET http://localhost:5000/leaves/manager/64f0b3c2f4a5a00099999999/irregular-patterns

### 11.5 Flag Request as Irregular
POST http://localhost:5000/leaves/manager/flag-irregular/693a800a7e07119e5fd6a9bd
Content-Type: application/json

{
  "flag": true,
  "reason": "Multiple Monday sick leaves in the last quarter"
}

### 11.6 Remove Irregular Flag
POST http://localhost:5000/leaves/manager/flag-irregular/693a800a7e07119e5fd6a9bd
Content-Type: application/json

{
  "flag": false
}

### 11.7 Get Pending Approvals Count
GET http://localhost:5000/leaves/manager/64f0b3c2f4a5a00099999999/pending-count

### =====================================================
### 12. ACCRUAL OPERATIONS
### =====================================================

### 12.1 Run Monthly Accrual
POST http://localhost:5000/leaves/accruals/run?referenceDate=2025-12-01
Content-Type: application/json

{
  "method": "monthly",
  "roundingRule": "round"
}

### 12.2 Run Yearly Accrual
POST http://localhost:5000/leaves/accruals/run?referenceDate=2025-01-01
Content-Type: application/json

{
  "method": "yearly",
  "roundingRule": "round_down"
}

### 12.3 Process Carry Forward
POST http://localhost:5000/leaves/accruals/carryforward?referenceDate=2026-01-01
Content-Type: application/json

{
  "capDays": 45,
  "expiryMonths": 12
}

### 12.4 Reset Leave Year - Calendar Year
POST http://localhost:5000/leaves/accruals/reset-year
Content-Type: application/json

{
  "strategy": "calendarYear",
  "referenceDate": "2026-01-01"
}

### 12.5 Reset Leave Year - By Hire Date
POST http://localhost:5000/leaves/accruals/reset-year
Content-Type: application/json

{
  "strategy": "hireDate"
}

### 12.6 Recalculate Employee Balance
GET http://localhost:5000/leaves/accruals/employee/693a80047e07119e5fd6a8d9/recalc

### 12.7 Adjust for Suspension Period
POST http://localhost:5000/leaves/accruals/adjust-suspension
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "fromDate": "2025-06-01",
  "toDate": "2025-06-30",
  "reason": "Unpaid leave - accrual suspended"
}

### =====================================================
### 13. PAYROLL INTEGRATION
### =====================================================

### 13.1 Sync Balance with Payroll
POST http://localhost:5000/leaves/payroll/sync-balance
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "balanceData": {
    "annualRemaining": 15,
    "sickRemaining": 7
  }
}

### 13.2 Sync Leave Approval
POST http://localhost:5000/leaves/payroll/sync-leave-approval
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "leaveData": {
    "leaveRequestId": "693a800a7e07119e5fd6a9bd",
    "leaveTypeId": "693a800a7e07119e5fd6a9a9",
    "durationDays": 5,
    "isPaid": true,
    "from": "2026-01-15",
    "to": "2026-01-20"
  }
}

### 13.3 Calculate Unpaid Deduction
POST http://localhost:5000/leaves/payroll/calculate-unpaid-deduction
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "baseSalary": 5000,
  "workDaysInMonth": 22,
  "unpaidLeaveDays": 3
}

### 13.4 Calculate Encashment
POST http://localhost:5000/leaves/payroll/calculate-encashment
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "dailySalaryRate": 227.27,
  "unusedLeaveDays": 15,
  "maxEncashableDays": 30
}

### 13.5 Sync Cancellation
POST http://localhost:5000/leaves/payroll/sync-cancellation
Content-Type: application/json

{
  "employeeId": "693a80047e07119e5fd6a8d9",
  "leaveRequestId": "693a800a7e07119e5fd6a9bd",
  "daysToRestore": 5
}

### =====================================================
### 14. STATISTICS AND REPORTS
### =====================================================

### 14.1 Get Leave Stats - All
GET http://localhost:5000/leaves/stats

### 14.2 Get Leave Stats - By Employee
GET http://localhost:5000/leaves/stats?employeeId=693a80047e07119e5fd6a8d9

### 14.3 Get Overdue Requests (default 48 hours)
GET http://localhost:5000/leaves/requests/overdue

### 14.4 Get Overdue Requests (custom hours)
GET http://localhost:5000/leaves/requests/overdue?hours=24

### 14.5 Escalate Overdue Requests
POST http://localhost:5000/leaves/requests/escalate-overdue

